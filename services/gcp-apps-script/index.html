<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-blue-500 p-8">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
      <h1 class="text-2xl font-bold text-center mb-6">Test Mission</h1>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">City:</label>
          <input
            type="text"
            id="city"
            placeholder="Madrid"
            class="w-full p-3 border rounded-lg"
          />
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Category:</label>
          <select id="category" class="w-full p-3 border rounded-lg">
            <option value="">Select...</option>
            <option value="Restaurants">Restaurants</option>
            <option value="Technology">Technology</option>
          </select>
        </div>

        <button
          onclick="startMission()"
          class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700"
        >
          üöÄ Start Mission
        </button>
      </div>

      <div id="result" class="mt-4 p-3 rounded-lg hidden"></div>

      <!-- Debug info -->
      <div class="mt-4 p-3 bg-gray-100 rounded text-sm">
        <p><strong>Debug:</strong></p>
        <p>City: <span id="debugCity">-</span></p>
        <p>Category: <span id="debugCategory">-</span></p>
        <p>Google Script Available: <span id="debugGoogleScript">-</span></p>
      </div>
    </div>

    <script>
      // Debug function
      function updateDebug() {
        document.getElementById("debugCity").textContent =
          document.getElementById("city").value;
        document.getElementById("debugCategory").textContent =
          document.getElementById("category").value;
        document.getElementById("debugGoogleScript").textContent =
          typeof google !== "undefined" && google.script ? "Yes" : "No";
      }

      // Update debug on input change
      document.getElementById("city").addEventListener("input", updateDebug);
      document
        .getElementById("category")
        .addEventListener("change", updateDebug);

      // Initial debug update
      updateDebug();

      function startMission() {
        console.log("startMission called"); // Debug log

        const city = document.getElementById("city").value;
        const category = document.getElementById("category").value;

        console.log("City:", city); // Debug log
        console.log("Category:", category); // Debug log

        if (!city || !category) {
          alert("Please fill in all fields");
          return;
        }

        console.log("Calling google.script.run..."); // Debug log

        try {
          google.script.run
            .withSuccessHandler(function (result) {
              console.log("Success:", result); // Debug log
              onSuccess(result);
            })
            .withFailureHandler(function (error) {
              console.log("Error:", error); // Debug log
              onError(error);
            })
            .startMission(city, category, "");
        } catch (error) {
          console.log("Exception:", error); // Debug log
          alert("Error calling Google Script: " + error.message);
        }
      }

      function onSuccess(result) {
        console.log("onSuccess called with:", result); // Debug log
        document.getElementById("result").innerHTML =
          '<div class="bg-green-100 text-green-800 p-3 rounded">‚úÖ Mission started! ID: ' +
          result.mission_id +
          "</div>";
        document.getElementById("result").classList.remove("hidden");
      }

      function onError(error) {
        console.log("onError called with:", error); // Debug log
        document.getElementById("result").innerHTML =
          '<div class="bg-red-100 text-red-800 p-3 rounded">‚ùå Error: ' +
          error.message +
          "</div>";
        document.getElementById("result").classList.remove("hidden");
      }
    </script>
  </body>
</html>
